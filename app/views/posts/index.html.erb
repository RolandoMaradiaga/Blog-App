<div class="container-fluid px-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1>All Posts</h1>
    <% if user_signed_in? %>
      <div>
        <%= link_to 'Create New Post', new_post_path, class: 'btn btn-success me-2' %>
        <%= link_to 'Edit Profile', edit_user_registration_path, class: 'btn btn-outline-primary me-2' %>
        <%= link_to 'Sign Out', destroy_user_session_path, method: :delete, class: 'btn btn-outline-danger' %>
      </div>
    <% else %>
      <div>
        <%= link_to 'Sign Up', new_user_registration_path, class: 'btn btn-outline-primary me-2' %>
        <%= link_to 'Log In', new_user_session_path, class: 'btn btn-primary' %>
      </div>
    <% end %>
  </div>

  <%= form_with(url: posts_path, method: :get, local: true, class: 'mb-3') do %>
    <div class="input-group">
      <%= text_field_tag :query, params[:query], class: 'form-control', placeholder: 'Search posts...' %>
      <button type="submit" class="btn btn-outline-secondary">Search</button>
    </div>
  <% end %>

  <% @posts.each do |post| %>
    <div class="card mb-3">
      <% cache([post, current_user.id]) do %> 
        <div class="card-body">
          <h2 class="card-title"><%= link_to post.title, post, class: 'text-decoration-none' %></h2>
          <p class="card-text"><%= post.body.truncate(100) %></p>
          <p class="card-subtitle text-muted">By <%= post.user.email %></p>
        </div>
      <% end %>

      <% if post.user == current_user %>
        <div class="card-footer mt-2">
          <%= link_to 'Edit', edit_post_path(post), class: 'btn btn-warning btn-sm me-2' %>
          <%= link_to 'Delete', post, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger btn-sm' %>
        </div>
      <% end %>
    </div>
  <% end %>

  <%= paginate @posts %>
</div>
